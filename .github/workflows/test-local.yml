name: Self-hosted Runner Workflow

on:
  workflow_dispatch: {}
  push:
    branches:
      - main # Replace with the branch name you want to trigger on
  pull_request:
    types:
      - opened
      - synchronize
      - closed
      
jobs:
  setup:
    runs-on: self-hosted
    steps:
      - name: Check out code
        uses: actions/checkout@v2
      - name: Check if Unity is in PATH Linux
        if: runner.os != 'Windows'
        run: |
          UNITY_PATH=$(which unity)
          if [ -n "$UNITY_PATH" ]; then
            echo "Unity is installed and is located at: $UNITY_PATH"
          else
            echo "Unity is not installed or not in the PATH."
            exit 1  # This line will stop the workflow with a failure status.
          fi
      - name: Check if Unity is in PATH Windows
        if: runner.os == 'Windows'
        run: |
          where.exe unity
          if %ERRORLEVEL%==0 (
            set UNITY_PATH=where.exe unity
            echo Unity is installed and is located at: %UNITY_PATH%
          ) else (
            echo Unity is not installed or not in the PATH.
            exit 1  # This line will stop the workflow with a failure status.
          )
      - name: Generate Project
        run: unity -batchmode -projectPath . -logfile -

  tests:
    runs-on: self-hosted
    steps:
      - name: list
        run: dir

  cleanup:
    runs-on: self-hosted
    needs: tests
    steps:
      - name: cleanup
        run: rm -r -- !(.) .*
